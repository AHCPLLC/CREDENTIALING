
@{
    Layout = null;
}

@*<div class="modal fade" id="preview">
    <div class="modal-dialog">
        <div class="modal-content">
            <div>
                <iframe src="~/Content/Document/DocPreview.pdf" class="col-lg-12" style="height:600px;"></iframe>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->*@

<div class="footer">
    <hr />
    <div class="col-lg-7">
        
    </div>
    <div class="col-lg-5 text-right">        
        <ul class="list-inline">            
            <li>@System.Configuration.ConfigurationManager.AppSettings["FooterStamp"]</li>
            <li></li><li></li>
        </ul>        
    </div>   
    <input type="hidden" value="@System.Configuration.ConfigurationManager.AppSettings["AppRoot"]" id="appRoot">
    <input type="hidden" value="" id="cdUserID">
</div>



<script>
    $(function () {
        $('[data-toggle="popover"]').popover();
        $('[data-toggle="tooltip"]').tooltip();
    })

    $(document).ready(function () {        
        console.log("changing size");
        var screen = $(window).width();

        if (screen < 1025) {
            $("#sidemenu").addClass("menu-in");
            $("#page-wrapper").addClass("menuup");
        }        
    });    
</script>
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<script>

    $(function () {

        Notify();
        // Declare a proxy to reference the hub.
        var cnd = $.connection.cnDHub;

        cnd.client.logoutCall = function (loggedInUserName) {
          
            if ($('#loggedInUserName').text() == loggedInUserName) {
                ////$('#logoutBtn').trigger('click');
                //var logOff = $('#appRoot').val();
                //$('#logoutForm').attr('action', logOff + '/Account/LogOff');
                document.getElementById('logoutForm').submit();
            };
        };

        cnd.client.Notification = function () {
            notify();
        }

        cnd.client.NotifyCDUserID = function (userIDs) {
            sessionStorage.setItem('CDUserID', userIDs.CDUserID);
            sessionStorage.setItem('UserAuthID', userIDs.UserAuthID);
        }

        cnd.client.NotifyCount = function (data) {
            //FetchRequestCounts();
            //console.log("realtime - " + data);
            $("#requestCounts").promise().then(function () {
                //$("#requestCounts")
                if (data > 0) {
                    //document.getElementById('requestCounts').innerHTML = data;
                    $("#requestCounts").empty();
                    $("#requestCounts").append(data);
                    $("#requestCounts").show();
                }
                else {
                    $("#requestCounts").hide();
                }


            })

        };

        cnd.client.NotifyClientTasksExpiriesCount = function (data) {
            if (sessionStorage.getItem('UserAuthID') == $("#userAuthID").val()) {
                var taskExpiredCounts = [];
                var taskToBeExpiredCounts = [];
                for (var i = 0; i < data.TasksExpiredCount.length; i++) {
                    if (data.TasksExpiredCount[i].AssignedToId.toString() === sessionStorage.getItem('CDUserID'))
                        taskExpiredCounts.push(data.TasksExpiredCount[i]);
                }

                for (var i = 0; i < data.TasksToBeExpiredCount.length; i++) {
                    if (data.TasksToBeExpiredCount[i].AssignedToId.toString() === sessionStorage.getItem('CDUserID'))
                        taskToBeExpiredCounts.push(data.TasksToBeExpiredCount[i]);
                }

                $("#expired_Task").promise().then(function () {
                    $("#expired_Task").empty();
                    $("#expired_Task").append(taskExpiredCounts.length);
                })

                $("#expiring_Task").promise().then(function () {
                    $("#expiring_Task").empty();
                    $("#expiring_Task").append(taskToBeExpiredCounts.length);
                })
            }
        };


        

        // Start the connection.
        $.connection.hub.start().done(function () {
            //Notify();
            cnd.server.storeCDUserIDIntoSession($("#userAuthID").val());
            cnd.server.notifyPendingRequestCount();
            cnd.server.notifyTasksExpiriesCount();
            $('#logoutBtn').click(function () {
                cnd.server.logout($('#loggedInUserName').text());
               
            });
        });
    });
</script>

